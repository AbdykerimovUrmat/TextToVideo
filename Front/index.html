<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>balyk</title>
</head>
<body style="background-color: black;">
	<form>
		<input type="text" id="text-input">
		<button onclick="btnclick(event)">I am button</button>
	</form>
	<script type="text/javascript">
		var localStorage = window.localStorage;
		isLoggedIn();

		async function btnclick(e) {
			e.preventDefault();

			var data = document.getElementById('text-input').value;
			if(!data) {
				alert("text field has to be filled");
				return;
			}
			var response = await fetch('http://localhost:42557/api/Request', {
				headers: {
			    	'Accept': 'plain/text',
			        'Content-Type': 'application/json',
			        'Authorization': token
			    },
				method: 'post',
				body: JSON.stringify({text: data})
			});

			if(response.status == 200) {
				alert("Successfully submited!");
			}
		};

		function redirectTo(page) {
			window.location.replace(page);
		}

		function isLoggedIn() {
			var token = localStorage.getItem('token'),
				email = localStorage.getItem('email'),
				expirationDate = localStorage.getItem('expirationDate'),
				expirationDateTimeStamp = new Date(expirationDate).getTime(),
				currentTimeStamp = new Date().getTime();

			if(!token || expirationDateTimeStamp >= currentTimeStamp) {
				alert("Login or register first");
				removeUserData();
				redirectTo("login.html");
			}
		}

		function removeUserData() {
			localStorage.removeItem('token');
			localStorage.removeItem('email');
			localStorage.removeItem('expirationDate');
		}

		//TODO:onclick logout; Add Hi email; Ensure expdate works
	</script>
	<a href="login.html" style="color:white;">Logout</a>
	<a href="register.html" style="color:white;">Register</a>
</body>
</html>